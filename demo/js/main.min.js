(function(){this.LKT={Router:{},Views:{},Utils:{},Models:{},Collections:{},Templates:{},Players:[],Config:{enviroment:"production",templates_path:"templates/",templates_type:"html",socketio_server:{local:"localhost:1347",production:"fear-the-dice-socket.herokuapp.com"},api_server:{local:"localhost:3000",production:"keepiteasy.net:3000"}}},$(function(a){var b;return a.Utils.guid=function(){var a;return a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},b=new Array("player","monster","base","dm","player_dm","monster_dm","player_sidebar","monster_sidebar"),_.each(b,function(b){var c;return c=a.Config.templates_path+b+"."+a.Config.templates_type,$.ajax({url:c,async:!1,dataType:"text",success:function(c){return a.Templates[b]=c,this}})}),a.socket=io("http://"+a.Config.socketio_server[a.Config.enviroment]),this}(window.LKT)),$(function(a){return a.Models.Monster=Backbone.Model.extend({defaults:{monster:"Bandit",turn:!1,initiative:12,ac:12,hp:11,speed:30,health:11,damage:0,xp:25,manual:343,thumb:"//www.fillmurray.com/g/200/140",playling:!1},initialize:function(b){return"undefined"==typeof b&&this.set("id",a.Utils.guid()),this}},this),this}(window.LKT)),$(function(a){return a.Models.Player=Backbone.Model.extend({defaults:{name:"John",character:"Sir Stabington",turn:!1,initiative:1,ac:12,speed:30,hp:10,health:10,damage:0,thumb:"//placekitten.com.s3.amazonaws.com/homepage-samples/200/140.jpg",playling:!1},initialize:function(b){return"undefined"==typeof b&&this.set("id",a.Utils.guid()),this}},this),this}(window.LKT)),$(function(a){return a.Collections.Game=Backbone.Collection.extend({comparator:function(a){return parseInt(-a.get("initiative"))}}),this}(window.LKT)),$(function(a){return a.Collections.Monster=Backbone.Collection.extend({model:a.Models.Monster,url:"http://"+a.Config.api_server[a.Config.enviroment]+"/monsters",comparator:function(a){return parseInt(-a.get("initiative"))}}),this}(window.LKT)),$(function(a){return a.Collections.Player=Backbone.Collection.extend({model:a.Models.Player,url:"http://"+a.Config.api_server[a.Config.enviroment]+"/players",comparator:function(a){return parseInt(-a.get("initiative"))}}),this}(window.LKT)),$(function(a){return a.Views.Base=Backbone.View.extend({tagName:"div",className:"container-fluid",events:{"click .turn__next_btn":"nextTurn"},pubsub_init:function(){return PubSub.subscribe("GameCollection.sort",$.proxy(this.reRender,this)),PubSub.subscribe("ActivePlayer",$.proxy(this.activePlayer,this))},socket_init:function(){return a.socket.on("EndTurn",$.proxy(function(b){var c;return b=JSON.parse(b),c=a.Collections.Game.get(b.id),c.view.endTurn(),c},this)),a.socket.on("StartTurn",$.proxy(function(b){var c;return b=JSON.parse(b),c=a.Collections.Game.get(b.id),c.view.startTurn(),c},this)),a.socket.on("NewPlayer",$.proxy(function(b){var c;return c=new this.playerModel(JSON.parse(b)),a.Collections.Game.push(c),new this.playerView(c),c},this)),a.socket.on("ExistingPlayers",$.proxy(function(b){return _.each(JSON.parse(b),$.proxy(function(b){var c;return b=new this.playerModel(b),c=_.find(a.Collections.Player.models,function(a){return a.get("id")===b.get("id")}),-1===c&&a.Collections.Player.add(b),b.get("playing")===!0&&a.Collections.Game.add(b),new this.playerView(b),b},this))},this)),a.socket.on("PlayerUpdate",$.proxy(function(b){var c;return b=JSON.parse(b),c=a.Collections.Game.get(b.id),c.set(b),c},this)),a.socket.on("PlayerRemoved",$.proxy(function(b){var c;return b=JSON.parse(b),c=a.Collections.Game.get(b.id),a.Collections.Game.remove(c),c},this)),a.socket.on("NewMonster",$.proxy(function(b){var c;return c=new this.monsterModel(JSON.parse(b)),a.Collections.Game.push(c),new this.monsterView(c),c},this)),a.socket.on("ExistingMonsters",$.proxy(function(b){return _.each(JSON.parse(b),$.proxy(function(b){var c;return b=new this.monsterModel(b),c=_.find(a.Collections.Monster.models,function(a){return a.get("id")===b.get("id")}),-1===c&&a.Collections.Monster.add(b),b.get("playing")===!0&&a.Collections.Game.add(b),new this.monsterView(b),b},this))},this)),a.socket.on("MonsterUpdate",$.proxy(function(b){var c;return b=JSON.parse(b),c=a.Collections.Game.get(b.id),c.set(b),c},this)),a.socket.on("MonsterRemoved",$.proxy(function(b){var c;return b=JSON.parse(b),c=a.Collections.Game.get(b.id),a.Collections.Monster.remove(c),c},this))},initialize:function(){return this.template=a.Templates.base,this.render(),this.playerModel=a.Models.Player,this.playerView=a.Views.Player,this.monsterModel=a.Models.Monster,this.monsterView=a.Views.Monster,this.turn=0,this.pubsub_init(),this.socket_init(),this},render:function(){return this.$el.html(Mustache.render(this.template)),this.$el},reRender:function(){return this.$el.find(".game").html(""),_.each(a.Collections.Game.models,$.proxy(function(a){var b;return b=a.view,this.$el.find(".game").append(b.$el),b.postRender()},this))},activePlayer:function(b,c){var d;return this.$el.addClass("active-player"),d=a.Collections.Game.get(c),new a.Views.PlayerDM(d),d.view.$el.addClass("active-player"),this.reRender()},nextTurn:function(b){return"undefined"!=typeof this.currentPlayer&&(this.currentPlayer.view.endTurn(),a.socket.emit("EndTurn",JSON.stringify(this.currentPlayer.toJSON()))),this.currentPlayer=a.Collections.Game.at(this.turn),a.socket.emit("StartTurn",JSON.stringify(this.currentPlayer.toJSON())),this.currentPlayer.view.startTurn(),this.turn=this.turn<a.Collections.Game.length-1?this.turn+1:0,this.currentPlayer}}),this}(window.LKT)),$(function(a){return a.Views.Dm=a.Views.Base.extend({events:{"click .players__add_btn":"addPlayer","click .monster__add_btn":"addMonster","click .turn__next_btn":"nextTurn"},initialize:function(){return this.template=a.Templates.dm,this.render(),this.playerModel=a.Models.Player,this.playerView=a.Views.PlayerDM,this.monsterModel=a.Models.Monster,this.monsterView=a.Views.MonsterDM,this.turn=0,this.pubsub_init(),this.socket_init(),this.loadPlayers(),this.loadMonsters()},pubsub_init:function(){return PubSub.subscribe("GameCollection.sort",$.proxy(this.reRender,this)),PubSub.subscribe("PlayerCollection.add",$.proxy(this.addSidebarPlayer,this)),PubSub.subscribe("MonsterCollection.add",$.proxy(this.addSidebarMonster,this))},addSidebarMonster:function(){return this.$el.find(".monsters").html(""),_.each(a.Collections.Monster.models,$.proxy(function(b){var c;return c=new a.Views.MonsterSidebar(b),this.$el.find(".monsters").append(c.$el)},this))},addSidebarPlayer:function(){return this.$el.find(".players").html(""),_.each(a.Collections.Player.models,$.proxy(function(b){var c;return c=new a.Views.PlayerSidebar(b),this.$el.find(".players").append(c.$el)},this))},loadMonsters:function(){return a.Collections.Monster.fetch()},loadPlayers:function(){return a.Collections.Player.fetch()},addPlayer:function(b){var c;return c=new a.Models.Player,c.set("playing",!0),new this.playerView(c),a.socket.emit("NewPlayer",JSON.stringify(c.toJSON())),a.Collections.Game.push(c),c},addMonster:function(b){var c;return c=new a.Models.Monster,c.set("playing",!0),new this.monsterView(c),a.socket.emit("NewMonster",JSON.stringify(c.toJSON())),a.Collections.Game.push(c),c}}),this}(window.LKT)),$(function(a){return a.Views.Monster=Backbone.View.extend({tagName:"div",className:"row",events:{"click .monster__hit":"hit","click .monster__hit--edit .glyphicon-check":"saveDamage"},initialize:function(b){return this.template=a.Templates.monster,this.model=b,this.model.view=this,this.model.set("id",this.model.id),this.open=!1,_.bindAll(this,"render"),this.model.bind("change",$.proxy(this.change,this)),this.render(),this},change:function(){var b;return b=this.model.get("hp")-this.model.get("damage"),this.model.set("health",b),PubSub.publish("MonsterUpdate",JSON.stringify(this.model.toJSON())),a.socket.emit("MonsterUpdate",JSON.stringify(this.model.toJSON())),this.render()},render:function(){return this.$el.html(Mustache.render(this.template,this.model.toJSON())),this.$el.addClass("monster"),this.$el},startTurn:function(){return this.model.set("turn",!0),this.$el.addClass("turn"),this.$el},endTurn:function(){return this.model.set("turn",!1),this.$el.removeClass("turn"),this.$el},postRender:function(){return this.reRender(),this.open===!1&&(this.$el.slideDown(),this.open=!0),this.delegateEvents(),this.$el},reRender:function(){return this.model.get("health")<=0?(this.$el.find(".monster__hit").hide(),this.$el.addClass("dead")):this.$el.removeClass("dead"),this.$el},hit:function(a){return this.$el.find(".monster__hit").hide(),this.$el.find(".monster__hit--edit").show()},saveDamage:function(a){var b,c;return c=parseInt(this.$el.find(".monster__hit--edit input").val()),this.$el.find(".monster__hit--edit").hide(),this.$el.find(".monster__hit--edit").val(0),this.$el.find(".monster__hit").show(),b={damage:this.model.get("damage")+c,health:this.model.get("health")-c},this.model.set(b),this.reRender()}}),this}(window.LKT)),$(function(a){return a.Views.MonsterDM=a.Views.Monster.extend({events:{"click .monster__stat":"editStat","click .monster__stat--value":"editStat","click .monster__stat--edit .glyphicon-check":"saveStat","click .monster__name":"editName","click .monster__name--edit .glyphicon-check":"saveName","click .monster__hit":"hit","click .monster__hit--edit .glyphicon-check":"saveDamage","click .monster__heal":"heal","click .monster__heal--edit .glyphicon-check":"saveHealing","click .monster__delete":"deleteMonster"},initialize:function(b){return this.template=a.Templates.monster_dm,this.model=b,this.model.view=this,this.model.set("id",this.model.id),this.open=!1,_.bindAll(this,"render"),this.model.bind("change",$.proxy(this.change,this)),this.render(),this},editName:function(a){var b;return b=$(a.currentTarget).parent(),b.find(".monster__name").hide(),b.find(".monster__name--edit input").val(this.model.get("monster")),b.find(".monster__name--edit").show()},saveName:function(a){var b,c;return b=$(a.currentTarget).parent().parent(),c=b.find(".monster__name--edit input").val(),this.model.set("monster",c),b.find(".monster__name--edit").hide(),b.find(".monster__name").show()},editStat:function(a){var b,c;return b=$(a.currentTarget).parent(),c=b.find(".monster__stat").attr("stat"),b.find(".monster__stat--value").hide(),b.find(".monster__stat--edit input").val(this.model.get(c)),b.find(".monster__stat--edit").show()},saveStat:function(a){var b,c,d;return b=$(a.currentTarget).parent().parent(),c=b.find(".monster__stat").attr("stat"),d=parseInt(b.find(".monster__stat--edit input").val()),this.model.set(c,d),b.find(".monster__stat--edit").hide(),b.find(".monster__stat--value").show(),"initiative"===c&&PubSub.publish("PlayerOrderChange"),this.reRender()},heal:function(a){return this.$el.find(".monster__heal").hide(),this.$el.find(".monster__heal--edit").show()},saveHealing:function(a){var b,c;return c=parseInt(this.$el.find(".monster__heal--edit input").val()),this.$el.find(".monster__heal--edit").hide(),this.$el.find(".monster__heal--edit").val(0),this.$el.find(".monster__heal").show(),b={damage:this.model.get("damage")-c,health:this.model.get("health")+c},b.damage=b.damage<0?0:b.damage,this.model.set(b),this.reRender()},deleteMonster:function(b){return a.socket.emit("MonsterRemoved",JSON.stringify(this.model.toJSON())),a.Collections.Game.remove(this.model),this.$el.remove()}}),this}(window.LKT)),$(function(a){return a.Views.MonsterSidebar=Backbone.View.extend({tagName:"div",className:"sidebar__monster",events:{"click i":"addMonster"},initialize:function(b){return this.template=a.Templates.monster_sidebar,this.model=b,this.render(),this},render:function(){return this.$el.html(Mustache.render(this.template,this.model.toJSON())),this.$el.addClass("text-center row"),this.$el},addMonster:function(){var b;return b=new a.Models.Monster,console.log(b),console.log(JSON.stringify(b.toJSON())),b.set("playing",!0),a.socket.emit("NewMonster",JSON.stringify(b.toJSON())),new a.Views.MonsterDM(b),a.Collections.Game.add(b)}}),this}(window.LKT)),$(function(a){return a.Views.Player=Backbone.View.extend({tagName:"div",className:"row",events:{"click .player__hit":"hitPlayer","click .player__control":"takeControl","click .player__hit--edit .glyphicon-check":"saveDamage"},initialize:function(b){return this.template=a.Templates.player,this.model=b,this.model.view=this,this.model.set("id",this.model.id),this.open=!1,_.bindAll(this,"render"),this.model.bind("change",$.proxy(this.change,this)),this.render(),this},change:function(){return PubSub.publish("PlayerUpdate",JSON.stringify(this.model.toJSON())),a.socket.emit("PlayerUpdate",JSON.stringify(this.model.toJSON())),this.render()},render:function(){return this.$el.html(Mustache.render(this.template,this.model.toJSON())),this.$el.addClass("player"),this.$el},startTurn:function(){return this.turn=!0,this.$el.addClass("turn"),this.$el},endTurn:function(){return this.turn=!1,this.$el.removeClass("turn"),this.$el},postRender:function(){return this.reRender(),this.open===!1&&(this.$el.slideDown(),this.open=!0),this.delegateEvents(),this.$el},reRender:function(){return this.model.get("damage")>=this.model.get("hp")?(this.$el.find(".player__hit").hide(),this.$el.addClass("dead")):this.$el.removeClass("dead"),this.$el},hitPlayer:function(a){return this.$el.find(".player__hit").hide(),this.$el.find(".player__hit--edit").show()},saveDamage:function(a){var b,c;return c=parseInt(this.$el.find(".player__hit--edit input").val()),this.$el.find(".player__hit--edit").hide(),this.$el.find(".player__hit--edit").val(0),this.$el.find(".player__hit").show(),b={damage:this.model.get("damage")+c,health:this.model.get("health")-c},this.model.set(b),this.reRender()},takeControl:function(a){return this.$el.addClass("active-player"),PubSub.publish("ActivePlayer",this.model.id)}}),this}(window.LKT)),$(function(a){return a.Views.PlayerDM=a.Views.Player.extend({events:{"click .player__stat":"editStat","click .player__stat--value":"editStat","click .player__stat--edit .glyphicon-check":"saveStat","click .character__name":"editCharacter","click .character__name--edit .glyphicon-check":"saveCharacter","click .player__name":"editName","click .player__name--edit .glyphicon-check":"saveName","click .player__hit":"hitPlayer","click .player__hit--edit .glyphicon-check":"saveDamage","click .player__heal":"healPlayer","click .player__heal--edit .glyphicon-check":"saveHealing","click .player__delete":"deletePlayer"},initialize:function(b){return this.template=a.Templates.player_dm,this.model=b,this.model.view=this,this.model.set("id",this.model.id),this.open=!1,_.bindAll(this,"render"),this.model.bind("change",$.proxy(this.change,this)),this.render(),this},change:function(){var b;return b=this.model.get("hp")-this.model.get("damage"),this.model.set("health",b),PubSub.publish("PlayerUpdate",JSON.stringify(this.model.toJSON())),a.socket.emit("PlayerUpdate",JSON.stringify(this.model.toJSON())),this.render()},editName:function(a){var b;return b=$(a.currentTarget).parent(),b.find(".player__name").hide(),b.find(".player__name--edit input").val(this.model.get("name")),b.find(".player__name--edit").show()},saveName:function(a){var b,c;return b=$(a.currentTarget).parent().parent(),c=b.find(".player__name--edit input").val(),this.model.set("name",c),b.find(".player__name--edit").hide(),b.find(".player__name").show()},editCharacter:function(a){var b;return b=$(a.currentTarget).parent(),b.find(".character__name").hide(),b.find(".character__name--edit input").val(this.model.get("character")),b.find(".character__name--edit").show()},saveCharacter:function(a){var b,c;return b=$(a.currentTarget).parent().parent(),c=b.find(".character__name--edit input").val(),this.model.set("character",c),b.find(".character__name--edit").hide(),b.find(".character__name").show()},editStat:function(a){var b,c;return b=$(a.currentTarget).parent(),c=b.find(".player__stat").attr("stat"),b.find(".player__stat--value").hide(),b.find(".player__stat--edit input").val(this.model.get(c)),b.find(".player__stat--edit").show()},saveStat:function(a){var b,c,d;return b=$(a.currentTarget).parent().parent(),console.log(b),c=b.find(".player__stat").attr("stat"),d=parseInt(b.find(".player__stat--edit input").val()),this.model.set(c,d),b.find(".player__stat--edit").hide(),b.find(".player__stat--value").show(),"initiative"===c&&PubSub.publish("PlayerOrderChange"),this.reRender()},healPlayer:function(a){return this.$el.find(".player__heal").hide(),this.$el.find(".player__heal--edit").show()},saveHealing:function(a){var b,c;return c=parseInt(this.$el.find(".player__heal--edit input").val()),this.$el.find(".player__heal--edit").hide(),this.$el.find(".player__heal--edit").val(0),this.$el.find(".player__heal").show(),b={damage:this.model.get("damage")-c,health:this.model.get("health")+c},b.damage=b.damage<0?0:b.damage,this.model.set(b),this.reRender()},deletePlayer:function(b){return a.socket.emit("PlayerRemoved",JSON.stringify(this.model.toJSON())),a.Collections.Game.remove(this.model),this.$el.remove()}}),this}(window.LKT)),$(function(a){return a.Views.PlayerSidebar=Backbone.View.extend({tagName:"div",className:"sidebar__player",events:{"click i":"addPlayer"},initialize:function(b){return this.template=a.Templates.player_sidebar,this.model=b,this.render(),this},render:function(){return this.$el.html(Mustache.render(this.template,this.model.toJSON())),this.$el.addClass("text-center row"),this.$el},addPlayer:function(){return this.model.set("playing",!0),a.socket.emit("NewPlayer",JSON.stringify(this.model.toJSON())),new a.Views.PlayerDM(this.model),a.Collections.Game.add(this.model)}}),this}(window.LKT)),$(function(a){var b;return b=Backbone.Router.extend({routes:{"":"home",dm:"dm"},home:function(){var b;return b=new a.Views.Base,$("body .base").html(b.$el)},dm:function(){var b;return b=new a.Views.Dm,$("body .base").html(b.$el)},pubsub_init:function(){return PubSub.subscribe("PlayerCollection.change",$.proxy(function(){return a.Collections.Player.sort()},this)),PubSub.subscribe("MonsterCollection.change",$.proxy(function(){return a.Collections.Monster.sort()},this))},initialize:function(){return a.Collections.Player=new a.Collections.Player,a.Collections.Monster=new a.Collections.Monster,a.Collections.Game=new a.Collections.Game,this.pubsub_init(),a.Collections.Player.bind("add",function(a){return PubSub.publish("PlayerCollection.add")}),a.Collections.Player.bind("change",function(){return PubSub.publish("PlayerCollection.change")}),a.Collections.Monster.bind("add",function(a){return PubSub.publish("MonsterCollection.add")}),a.Collections.Monster.bind("change",function(){return PubSub.publish("MonsterCollection.change")}),a.Collections.Game.bind("add",function(){return a.Collections.Game.sort(),PubSub.publish("GameCollection.add")}),a.Collections.Game.bind("change",function(){return a.Collections.Game.sort(),PubSub.publish("GameCollection.change")}),a.Collections.Game.bind("sort",function(){return PubSub.publish("GameCollection.sort")})}}),new b,Backbone.history.start(),this}(window.LKT))}).call(this);
//# sourceMappingURL=main.min.js.map